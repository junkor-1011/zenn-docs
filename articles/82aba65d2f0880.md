---
title: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã¤ããƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚’çµŒç”±ã—ã¦443ç•ªãƒãƒ¼ãƒˆã§GitHub/BitBucket/GitLabã«sshæ¥ç¶šã™ã‚‹"
emoji: "ğŸ›¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [linux, ssh, proxy]
published: true
---

å…ˆè¡Œç ”ç©¶ã¨ã—ã¦

https://qiita.com/pinemz/items/4be98d4ff446e7fd023b

https://qiita.com/306_san/items/28c36e52346f315d0860

ãªã©ãŒã‚ã‚‹ãŒã€ãƒ—ãƒ­ã‚­ã‚·ã¸ã®æ¥ç¶šã«ãƒ¦ãƒ¼ã‚¶ãƒ¼å + ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§èªè¨¼ãŒå¿…è¦ãªå ´åˆ(ã¤ã¾ã‚Šã€ä¾‹ãˆã°`http://username:password@proxy.example.com:80`ã¿ãŸã„ãªURLã‚’`http_proxy`ã‚„`https_proxy`ã«ã‚»ãƒƒãƒˆã—ã¦ä½¿ã†ã‚ˆã†ãªç’°å¢ƒ)ã§ã¯è¿½åŠ ã§å·¥å¤«ãŒå¿…è¦ã«ãªã£ãŸãŸã‚ãƒ¡ãƒ¢ã—ã¦ãŠãã€‚

WSLãªã©ãŒä½¿ãˆã‚‹å‰æã¨ã—ã¦ã€Linuxç’°å¢ƒã§ã®è¨­å®šã«ã¤ã„ã¦è¨˜è¿°ã™ã‚‹ã€‚

(ãªãŠã€æ¤œè¨¼ã¯WSL2ã®Ubuntu24.04ã¨BitBucketã‚’ä½¿ã£ã¦å®Ÿæ–½ã—ãŸ)

## çµè«–

netcatç³»ã®ã‚³ãƒãƒ³ãƒ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§é ‘å¼µã‚‹

### 1. nc(netcat-openbsd)ã‚’ä½¿ã†å ´åˆ

Ubuntu24.04(noble)ãªã©ã§ã¯ãŸã¶ã‚“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¥ã£ã¦ã„ã‚‹ã®ã§æ‰‹è»½

man page:

https://man.openbsd.org/nc.1

ä»¥ä¸‹ã®å†…å®¹ã‚’`~/.ssh/config`ã«è¿½è¨˜ã™ã‚‹

```sshconfig:~/.ssh/config
# GitHub/BitBucket/GitLabã«ã¤ã„ã¦å¿…è¦ãªã‚‚ã®ã‚’é¸ã‚“ã§è¿½è¨˜ã™ã‚‹

# GitHub
Host github.com
    HostName ssh.github.com
    User git
    Port 443
    # â†“å„è‡ªã®ç’°å¢ƒã§é©å½“ã«å¤‰ãˆã‚‹
    identityFile ~/path/to/git_secret_key
    # â†“å„è‡ªã®ç’°å¢ƒã«åˆã‚ã›ã¦<>éƒ¨åˆ†ã¯é©å®œç½®ãæ›ãˆã‚‹
    ProxyCommand nc -X connect -x <ãƒ—ãƒ­ã‚­ã‚·ã®DNSå or IPã‚¢ãƒ‰ãƒ¬ã‚¹>:<ãƒãƒ¼ãƒˆç•ªå·> -P <ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å> %h %p
    # ç’°å¢ƒå¤‰æ•°https_proxyãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€â†“ã§ã‚‚ãŠãã‚‰ãå¯
    # ProxyCommand nc -X connect -x $(echo $https_proxy | awk -F"@" '{print $2}') -P $(echo $https_proxy | awk -F":" '{print $2}' | awk -F"//" '{print $2}') %h %p

# BitBucket
Host bitbucket.org
    HostName altssh.bitbucket.org
    User git
    Port 443
    # â†“å„è‡ªã®ç’°å¢ƒã§é©å½“ã«å¤‰ãˆã‚‹
    identityFile ~/path/to/git_secret_key
    # â†“å„è‡ªã®ç’°å¢ƒã«åˆã‚ã›ã¦<>éƒ¨åˆ†ã¯é©å®œç½®ãæ›ãˆã‚‹
    ProxyCommand nc -X connect -x <ãƒ—ãƒ­ã‚­ã‚·ã®DNSå or IPã‚¢ãƒ‰ãƒ¬ã‚¹>:<ãƒãƒ¼ãƒˆç•ªå·> -P <ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å> %h %p
    # ç’°å¢ƒå¤‰æ•°https_proxyãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€â†“ã§ã‚‚ãŠãã‚‰ãå¯
    # ProxyCommand nc -X connect -x $(echo $https_proxy | awk -F"@" '{print $2}') -P $(echo $https_proxy | awk -F":" '{print $2}' | awk -F"//" '{print $2}') %h %p

# GitLab
Host gitlb.com
    HostName altssh.gitlab.com
    User git
    Port 443
    # â†“å„è‡ªã®ç’°å¢ƒã§é©å½“ã«å¤‰ãˆã‚‹
    identityFile ~/path/to/git_secret_key
    # â†“å„è‡ªã®ç’°å¢ƒã«åˆã‚ã›ã¦<>éƒ¨åˆ†ã¯é©å®œç½®ãæ›ãˆã‚‹
    ProxyCommand nc -X connect -x <ãƒ—ãƒ­ã‚­ã‚·ã®DNSå or IPã‚¢ãƒ‰ãƒ¬ã‚¹>:<ãƒãƒ¼ãƒˆç•ªå·> -P <ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å> %h %p
    # ç’°å¢ƒå¤‰æ•°https_proxyãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€â†“ã§ã‚‚ãŠãã‚‰ãå¯
    # ProxyCommand nc -X connect -x $(echo $https_proxy | awk -F"@" '{print $2}') -P $(echo $https_proxy | awk -F":" '{print $2}' | awk -F"//" '{print $2}') %h %p
```

ãŸã ã—ã€ncã‚³ãƒãƒ³ãƒ‰ã§ã¯èªè¨¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã©ã§è¨­å®šå‡ºæ¥ãªã„ãŸã‚éƒ½åº¦ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ãªã„ã¨ã„ã‘ãªã„ã€‚

`awk`ã‚’ä½¿ã£ãŸãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼éƒ¨åˆ†ã«ã¤ã„ã¦ã€ã“ã£ã¡ã‚’ä½¿ã†ã¨ã‚ã‚‰ã‚†ã‚‹ç’°å¢ƒã§ä½¿ã„ã¾ã‚ã—ãŒå‡ºæ¥ã‚‹ä¸€æ–¹ã€ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŠã‚ˆã³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«`:`ã‚„`@`ãŒå…¥ã£ã¦ã„ã‚‹ã¨ã†ã¾ãå‹•ã‹ãªã„å¯èƒ½æ€§ã‚‚ã‚ã‚‹ã®ã§æ³¨æ„ã€‚

### 2. ncat(nmap-ncat)ã‚’ä½¿ã†å ´åˆ

https://nmap.org/ncat/

`apt install ncat`ã‚„`dnf install nmap-ncat`ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã€‚

å¾Œç™ºãªåˆ†é«˜æ©Ÿèƒ½ãªã‚ˆã†ã§ã€ã“ã¡ã‚‰ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¾ã§è¨­å®šã§ãã‚‹ã®ã§ä¾¿åˆ©

ncatã‚’ä½¿ã†å ´åˆã¯ä»¥ä¸‹ã®å†…å®¹ã‚’`~/.ssh/config`ã«è¿½è¨˜

```sshconfig:~/.ssh/config
# GitHub/BitBucket/GitLabã«ã¤ã„ã¦å¿…è¦ãªã‚‚ã®ã‚’é¸ã‚“ã§è¿½è¨˜ã™ã‚‹

# GitHub
Host github.com
    HostName ssh.github.com
    User git
    Port 443
    # â†“å„è‡ªã®ç’°å¢ƒã§é©å½“ã«å¤‰ãˆã‚‹
    identityFile ~/path/to/git_secret_key
    # â†“å„è‡ªã®ç’°å¢ƒã«åˆã‚ã›ã¦<>éƒ¨åˆ†ã¯é©å®œç½®ãæ›ãˆã‚‹
    ProxyCommand ncat --proxy-type http --proxy <ãƒ—ãƒ­ã‚­ã‚·ã®DNSå or IPã‚¢ãƒ‰ãƒ¬ã‚¹>:<ãƒãƒ¼ãƒˆç•ªå·> --proxy-auth <ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å>:<ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰> %h %p
    # ç’°å¢ƒå¤‰æ•°https_proxyãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€â†“ã§ã‚‚ãŠãã‚‰ãå¯
    # ProxyCommand ncat --proxy-type http --proxy $(echo $https_proxy | awk -F"@" '{print $2}') --proxy-auth $(echo $https_proxy | awk -F":" '{print $2}' | awk -F"//" '{print $2}'):$(echo $https_proxy | awk -F":" '{print $3}' | awk -F"@" '{print $1}') %h %p

# BitBucket
Host bitbucket.org
    HostName altssh.bitbucket.org
    User git
    Port 443
    # â†“å„è‡ªã®ç’°å¢ƒã§é©å½“ã«å¤‰ãˆã‚‹
    identityFile ~/path/to/git_secret_key
    # â†“å„è‡ªã®ç’°å¢ƒã«åˆã‚ã›ã¦<>éƒ¨åˆ†ã¯é©å®œç½®ãæ›ãˆã‚‹
    ProxyCommand ncat --proxy-type http --proxy <ãƒ—ãƒ­ã‚­ã‚·ã®DNSå or IPã‚¢ãƒ‰ãƒ¬ã‚¹>:<ãƒãƒ¼ãƒˆç•ªå·> --proxy-auth <ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å>:<ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰> %h %p
    # ç’°å¢ƒå¤‰æ•°https_proxyãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€â†“ã§ã‚‚ãŠãã‚‰ãå¯
    # ProxyCommand ncat --proxy-type http --proxy $(echo $https_proxy | awk -F"@" '{print $2}') --proxy-auth $(echo $https_proxy | awk -F":" '{print $2}' | awk -F"//" '{print $2}'):$(echo $https_proxy | awk -F":" '{print $3}' | awk -F"@" '{print $1}') %h %p

# GitLab
Host gitlb.com
    HostName altssh.gitlab.com
    User git
    Port 443
    # â†“å„è‡ªã®ç’°å¢ƒã§é©å½“ã«å¤‰ãˆã‚‹
    identityFile ~/path/to/git_secret_key
    # â†“å„è‡ªã®ç’°å¢ƒã«åˆã‚ã›ã¦<>éƒ¨åˆ†ã¯é©å®œç½®ãæ›ãˆã‚‹
    ProxyCommand ncat --proxy-type http --proxy <ãƒ—ãƒ­ã‚­ã‚·ã®DNSå or IPã‚¢ãƒ‰ãƒ¬ã‚¹>:<ãƒãƒ¼ãƒˆç•ªå·> --proxy-auth <ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å>:<ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰> %h %p
    # ç’°å¢ƒå¤‰æ•°https_proxyãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€â†“ã§ã‚‚ãŠãã‚‰ãå¯
    # ProxyCommand ncat --proxy-type http --proxy $(echo $https_proxy | awk -F"@" '{print $2}') --proxy-auth $(echo $https_proxy | awk -F":" '{print $2}' | awk -F"//" '{print $2}'):$(echo $https_proxy | awk -F":" '{print $3}' | awk -F"@" '{print $1}') %h %p

```

å…ˆã»ã©ã¨åŒæ§˜ã§ã€`awk`ã‚’ä½¿ã£ãŸãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼éƒ¨åˆ†ã«ã¤ã„ã¦ã€ã“ã£ã¡ã‚’ä½¿ã†ã¨ã‚ã‚‰ã‚†ã‚‹ç’°å¢ƒã§ä½¿ã„ã¾ã‚ã—ãŒå‡ºæ¥ã‚‹ä¸€æ–¹ã€ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŠã‚ˆã³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«`:`ã‚„`@`ãŒå…¥ã£ã¦ã„ã‚‹ã¨ã†ã¾ãå‹•ã‹ãªã„å¯èƒ½æ€§ã‚‚ã‚ã‚‹ã®ã§æ³¨æ„ã€‚

## ã¡ã‚‡ã£ã¨ã ã‘è£œè¶³

å‰æã¨ã—ã¦ã€SaaSç‰ˆ(ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ä½¿ã‚ã‚Œã¦ã‚‹æ–¹)ã®GitHub/BitBucket/GitLabã¯443ç•ªãƒãƒ¼ãƒˆã§sshã§ãã‚‹ãŸã‚ã®ä»£æ›¿ã®DNSåã‚’æŒã£ã¦ã„ã‚‹ã€‚

GitHub: ssh.github.com

https://docs.github.com/ja/authentication/troubleshooting-ssh/using-ssh-over-the-https-port

BitBucket: altssh.bitbucket.org

https://ja.confluence.atlassian.com/bbkb/bitbucket-cloud-ssh-host-key-rotation-faq-1235851234.html

â†‘ç›´æ¥çš„ãªè¨˜è¿°ã¯ç„¡ã„ãŒã€
> 11. Q: Iâ€™m using port 443 instead of default port 22 to connect to bitbucket.org over SSH and run my connection via altssh.bitbucket.org to connect to Bitbucket. (...)

ãªã©ã¨æ›¸ã„ã¦ã‚ã‚‹

GitLab: altssh.gitlab

https://about.gitlab.com/blog/2016/02/18/gitlab-dot-com-now-supports-an-alternate-git-plus-ssh-port/

ã“ã“ã§ã€GitHub/BitBucket/GitLabã«ãŠã‘ã‚‹sshæ¥ç¶šã‚’ä½¿ã£ãŸå ´åˆã®gitãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®URLã¯åŸºæœ¬çš„ã«

- GitHub: `git@github.com:<ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå>/<ãƒªãƒã‚¸ãƒˆãƒªå>.git`
- BitBucket: `git@bitbucket.org:<ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå>/<ãƒªãƒã‚¸ãƒˆãƒªå>.git`
- GitLab: `git@gitlab.com:<ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå>/<ãƒªãƒã‚¸ãƒˆãƒªå>.git`

ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚

ã“ã‚Œã«å¯¾ã—ã¦å…ˆç¨‹æ›¸ã„ãŸã‚ˆã†ãªå†…å®¹ã§sshconfig(`~/.ssh/config`)ã‚’è¨­å®šã™ã‚‹ã¨ã€
ä¸Šè¨˜URLã¯ä¸€åˆ‡å¤‰æ›´ã›ãšã¨ã‚‚ã€å®Ÿéš›ã«æ¥ç¶šã—ã«ã„ãã¨ãã¯URLã¨ãƒãƒ¼ãƒˆç•ªå·ã‚’443æ¥ç¶šç”¨ã®æ–¹ã«å¤‰ãˆã‚‰ã‚Œã‚‹ã€ã¨ã„ã†ã®ãŒå¤§ã¾ã‹ãªä»•çµ„ã¿ã€‚

```sshconfig
Host <ä»»æ„ã®åå‰>
    HostName <å®Ÿéš›ã®DNSå>
    # ãã®ä»–sshã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«å¯¾å¿œã—ãŸã‚ã‚‰ã‚†ã‚‹è¨­å®š
```

ã¨æ›¸ã„ã¦ãŠãã¨ã€`ssh <ä»»æ„ã®åå‰>`ã¨ã™ã‚‹ã¨å®Ÿéš›ã«ã¯`ssh <ã‚‚ã‚ã‚‚ã‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³> <å®Ÿéš›ã®DNSå>`ã«å¤‰æ›ã•ã‚Œã‚‹ãŸã‚ã€
Hostã«`bitbucket.org`ã€HostNameã«`altssh.bitbucket.org`ã‚’è¨­å®šã—ã¦ãŠãã¨`bitbucket.org`ã¸ã®sshã¯é©å½“ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã—ãŸ`altssh.bitbucket.org`ã¸ã®sshã¸ã¨ä¸Šæ›¸ãã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

ã“ã“ã§ã€ãŠãã‚‰ãã‚ªãƒ³ãƒ—ãƒ¬ç’°å¢ƒãªã©ã§è‡ªå‰ã§ç«‹ã¦ãŸGitLabã ã£ãŸã‚Šã€GitHub Enterpriseãªã©ã§ã¯ç›¸å½“ã™ã‚‹ä»•çµ„ã¿ã‚’è‡ªåˆ†ã§ä½œã‚‰ãªã„ã¨åŒã˜ã“ã¨ã¯å‡ºæ¥ãªã„ã®ã§æ³¨æ„ã€‚

## ãã®ä»–

ãƒ—ãƒ­ã‚­ã‚·ã¨é—˜ã†(?)ãƒã‚¦ãƒã‚¦ã¨ã—ã¦ã€

https://zenn.dev/junkor/articles/ca961ca70f441a

ãªã©ã‚‚å‚è€ƒ
