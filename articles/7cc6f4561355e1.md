---
title: "electron + electron-builder + viteでデスクトップアプリを作ってみる"
emoji: "🖥"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["electron", "vite", "pnpm", "typescript"]
published: false
---

web 技術を応用してデスクトップアプリを作る技術の一つとして[electron](https://www.electronjs.org/ja/)があり、
アプリのメインプロセスから GUI 部分までの全てを Node.js で構築できるため開発言語およびパッケージ管理ツールを一元化できるメリットがある。

[Vite](https://ja.vitejs.dev/)が公式で提供している[サンプルのテンプレート](https://ja.vitejs.dev/guide/#vite-%E3%82%92%E3%82%AA%E3%83%B3%E3%83%A9%E3%82%A4%E3%83%B3%E3%81%A6%E3%82%99%E8%A9%A6%E3%81%99)を使って SPA な感じの GUI を作り、更に[electron-builder](https://www.electron.build/)を使うことでクロスプラットフォームビルド(今回は Linux と Windows)を行う方法を調べたので備忘録としてまとめる。

なお、今回の調査で作成したボイラープレートのようなものは以下に格納した：

https://github.com/junkor-1011/electron-vite-react-sample-2023/tree/zenn-handson

pnpm でワークスペースを作成しており、

- 親ワークスペース: [electron-builder](https://www.electron.build/)によるアプリのビルド
- `electron`ワークスペース: electron の main プロセスの処理を記述
- `renderer`ワークスペース: electron の renderer プロセス(GUI 部分)の処理を記述

のような感じで責務分離をしている。

構成と手順の要点をピックアップして以下に記述していく。

## 検証環境や主要ツール・ライブラリのバージョンなど

再現性のため、メモしておく:

- Linux(Fedora38) on WSL2@Windows11
  - CPU アーキテクチャは普通に x86_64
- Node.js v18.16.0
  - パッケージマネージャーは[pnpm](https://pnpm.io/ja/)@v8.6.x を使用

## 各ワークスペースについての解説

都合上、

0. pnpm ワークスペースの構築
1. main プロセス(`electron`ワークスペース)
2. renderer プロセス(`renderer`ワークスペース)
3. `electron-builder`によるアプリのビルド(親ワークスペース)

の順で記述していく。

### 0. pnpm ワークスペースの構築

個人的に node_modules の中身をなるべくきれいにしておきたかったりするのでプロジェクト作成には pnpm を使う。
(試していないが、npm や yarn でも概ね同様に作れるはず。)

pnpm を使ったワークスペースの作成・管理の基本は[公式の解説](https://pnpm.io/ja/workspaces)を参照のこと。

まずは適当な空のディレクトリを作成し、そこに移動して

```bash
pnpm init
```

などで node プロジェクトを立ち上げる。

今回は 2 つのワークスペース: `electron`と`renderer`を作るので、プロジェクトのルートディレクトリに以下のような内容の`pnpm-workspace.yaml`を作成する:

```yaml:pnpm-workspace.yaml
package:
  - 'electron'
  - 'renderer'
```

また、後々`electron-builder`を使うときのために`electron`モジュールは[public-hoisted-pattern](https://pnpm.io/ja/npmrc#public-hoist-pattern)に含めておく必要があるため、
プロジェクトのルートディレクトリに`.npmrc`を作成し、以下のような内容を追加しておく:

```dosini:npmrc
public-hoist-pattern[] = electron
```

#### (pnpm 設定の補足)

後で使用する`electron-builder`の[pnpm 向けの説明](https://www.electron.build/#note-for-pnpm)を見ると、
`.npmrc`で

```dosini:.npmrc
node-linker = hoisted

# or
public-hoist-pattern = *

# or
shamefully-hoist = true
```

を設定するように記載されている。
このようにすることで、npm や yarn(v1)でプロジェクトを作成したときと同様に、flat な`node_modules`が作成される。

が、main プロセスおよび renderer プロセスそれぞれビルドする際に必要なモジュールをバンドルするように設定しておけば全パッケージを flat に置く必要は無い。そのため、今回は`electron`だけを`public-hoist-pattern[]`に含めるようにする

### 1. main プロセス

(under construction)
