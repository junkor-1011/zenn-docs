---
title: "electronãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œã£ã¦ã¿ã‚‹(SPA by vite, MPA by Next.js)"
emoji: "ğŸ™Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["electron", "TypeScript", "pnpm", "vite", "nextjs"]
published: false
---

å€‹äººçš„ã«ã—ã£ãã‚Šãã‚‹?[Electron](https://www.electronjs.org/ja/docs/latest)ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš„ãªã‚‚ã®ã‚’æ¨¡ç´¢ã—ã¦ã¿ãŸè¨˜éŒ²ã€‚

## TL;DR;

ä½œã£ãŸã‚‚ã®(SPA ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ MPA ãƒãƒ¼ã‚¸ãƒ§ãƒ³)ã‚’ãã‚Œãã‚Œä»¥ä¸‹ã«ç½®ãã€‚

- SPA(Single Page Application) by vite + React

https://github.com/junkor-1011/electron-vite-react-sample-2023/tree/2023-06-28_2

- MPA(Multi Page Appliation) by nextjs

https://github.com/junkor-1011/electron-nextjs-sample-2023/tree/2023-06-28

ãã‚Œãã‚Œå…±é€šã—ã¦ã€

```bash
# é–‹ç™ºã«å¿…è¦ãªnpmãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm install

# ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–
pnpm dist     # Linuxå‘ã‘
pnpm dist:win # Windowså‘ã‘

# é–‹ç™ºæ™‚ã«ãŠã‘ã‚‹ã‚¢ãƒ—ãƒªã®å®Ÿè¡Œ(ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã«é–¢ã—ã¦ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã€ãã®ä»–ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–ãªã©)
pnpm dev
```

ã®ã‚ˆã†ãªæ„Ÿã˜ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚

ã„ãšã‚Œã‚‚ Linux ä¸Šã§ã®é–‹ç™ºã‚’æƒ³å®šã—ã¦ãŠã‚Šã€Docker ã§ãƒ“ãƒ«ãƒ‰ç”¨ã‚³ãƒ³ãƒ†ãƒŠã‚’ç«‹ã¡ä¸Šã’ã‚‹ã“ã¨ã§ Windows å‘ã‘ã®ãƒ“ãƒ«ãƒ‰ã‚‚å¯èƒ½ã«ã—ã¦ã„ã‚‹ã€‚
(MacOS å‘ã‘ãƒ“ãƒ«ãƒ‰ã¯å€‹äººçš„ã«å¿…è¦æ€§ãŒç„¡ã‹ã£ãŸã‚Šã€ãã‚‚ãã‚‚æ‰€æœ‰ã—ã¦ãªã„ã®ã§å‹•ä½œç¢ºèªã§ããªã„ã¨ã‹ã§æœªå¯¾å¿œã€‚)

ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãªã©ã¯å„ãƒªãƒã‚¸ãƒˆãƒªã®`package.json`ãªã©ã§è¦å®šã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã“ã®è¨˜äº‹ã§ã¯ç‰¹ã«è§¦ã‚Œãªã„ã€‚

## è§£èª¬ãªã©

æœ€ä½é™ã€ä½•ã‚’ã©ã†ã„ã†ã¤ã‚‚ã‚Šã§ä½œã£ãŸã®ã‹ã‚’è£œè¶³ã—ã¦ã„ãã€‚

2 ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªã®ãƒªãƒ³ã‚¯ã‚’è²¼ã£ãŸãŒã€ã©ã¡ã‚‰ã‚‚æœ¬è³ªçš„ã«ã¯ã‚ã¾ã‚Šå¤‰ã‚ã‚‰ãªã„ãŸã‚ã€[SPA ç‰ˆ](https://github.com/junkor-1011/electron-vite-react-sample-2023/tree/2023-06-28_2)ã®æ–¹ã‚’ãƒ™ãƒ¼ã‚¹ã«æ›¸ãã¤ã¤ã€å·®åˆ†ãŒã‚ã‚‹ã¨ã“ã‚ã ã‘å°‘ã—è£œè¶³ã™ã‚‹ã€‚

ä¸»ãªãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ã¯ã€

- ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«ã‚ˆã‚‹æ©Ÿèƒ½åˆ†é›¢
- [esbuild](https://github.com/evanw/esbuild) ã¨ [electron-builder](https://github.com/electron-userland/electron-builder) ã‚’ä½¿ã£ãŸãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–
- é–‹ç™ºç”¨ã®å®Ÿè¡Œã®ã‚µãƒãƒ¼ãƒˆ(â€»ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®ã¿)
- ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ç™»éŒ²ã«ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹
  - SPA: [electron-serve](https://github.com/sindresorhus/electron-serve)
  - MPA: [å‰æ›¸ã„ãŸè¨˜äº‹](https://zenn.dev/junkor/articles/676c4822e71daf)
- å‹ã® export/import ã«ã‚ˆã‚‹ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®å”èª¿

ãªã©ãŒæŒ™ã’ã‚‰ã‚Œã€ãã‚Œãã‚Œã–ã£ãã‚Šèª¬æ˜ã™ã‚‹ã€‚

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ(ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«ã‚ˆã‚‹æ©Ÿèƒ½åˆ†é›¢)

[pnpm workspace](https://pnpm.io/ja/workspaces)ã‚’ä½¿ã„ã€

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ç®¡ç†ã¨ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰(è¦ªãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹)
- ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹(å­ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹: `electron`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)
- ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹(å­ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹: `renderer`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)

ã®ã‚ˆã†ã«å¤§ãã 3 ã¤ã«æ©Ÿèƒ½ã‚’åˆ†é›¢ã—ã€ãã‚Œãã‚Œã‚’ãªã‚‹ã¹ãç–çµåˆãªæ„Ÿã˜ã«ã—ãŸã€‚
(ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ react ã¨ã‹ã‚’ import ã§ããŸã‚Šã™ã‚‹ã®æ°—æŒã¡æ‚ªã„ã—ã€ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å´ã‹ã‚‰ electron ã‚’ import ã§ãã¡ã‚ƒã†ã¨ã‹ã‚‚å«Œãªã®ã§)

ãªãŠã€æ§‹æˆã‚„é–‹ç™ºãƒ»ãƒ“ãƒ«ãƒ‰ã«å¿…è¦ãªã‚³ãƒãƒ³ãƒ‰ã‚’è€ƒãˆã‚‹ä¸Šã§ã€nextjs ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã® 1 ã¤ã§ã‚ã‚‹[with-electron-typescript](https://github.com/vercel/next.js/tree/v13.4.7/examples/with-electron-typescript):

https://github.com/vercel/next.js/tree/v13.4.7/examples/with-electron-typescript

ã‚’å‚è€ƒã«ã—ã¦ã„ã‚‹ã€‚
(è¨˜è¿°ãŒå¤ã‹ã£ãŸã‚Šã€å€‹äººçš„ã«ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åŒ–ã—ãŸã‹ã£ãŸãªã©ã®ç†ç”±ã§å‰²ã¨å…¨é¢çš„ã«ä½œã‚Šå¤‰ãˆãŸãŒ)

### ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–

é–‹ç™ºã¯ Linux ä¸Šã§ã‚„ã£ã¦ã„ã‚‹ãŒã€å€‹äººçš„ã«ä½œã‚ŠãŸã‹ã£ãŸã®ã¯ Windows å‘ã‘ã ã£ãŸã‚Šã—ãŸã®ã§ã€
ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰ãŒã§ãã‚‹ã‚ˆã†ã«[electron-builder](https://github.com/electron-userland/electron-builder)ã‚’ä½¿ã£ã¦ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚

#### electron-builder ã®è¨­å®š

è¦ªãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã® package.json ã®`build`éƒ¨åˆ†ã§å¿…è¦ãªè¨­å®šã‚’è¡Œã£ã¦ã„ã‚‹ã€‚

https://github.com/junkor-1011/electron-vite-react-sample-2023/blob/2023-06-28_2/package.json

```json:package.json(æŠœç²‹)
{
  "build": {
    "productName": "example-app",
    "asar": true,
    "files": [
      "main",
      "renderer/dist"
    ],
    "linux": {
      "executableName": "example-app"
    }
  }
}
```

`files`ã§ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å«ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã€‚
ãã®ãŸã‚ã€ã“ã“ã§æŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¡Œã†å‰ã«å¿…ãšå‡ºæ¥ã¦ã„ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
(ä»Šå›ã§ã¯ã€npm-script,ã®`build`ã‚³ãƒãƒ³ãƒ‰ã§ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ä¸¡æ–¹ã®ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã†ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚)

å®Ÿç”¨çš„ã«ã¯ã¾ã è‰²ã€…ãªè¨­å®šã¯ã„ã‚‹ã¯ãšã§ã‚ã‚Šã€
https://www.electron.build/configuration/configuration
ãªã©ã‚’å‚è€ƒã«ã—ã¦é©å®œè¨­å®šã—ã¦ã„ãã€‚

#### npmrc ã«ã‚ˆã‚‹ npm module ã® hoisted ã®è¨­å®š

ä»Šå›ã¯å…ˆè¿°ã®é€šã‚Š pnpm ã§ç’°å¢ƒæ§‹ç¯‰ã‚’è¡Œã£ã¦ã„ã‚‹ãŒã€[å…¬å¼ Introduction](https://www.electron.build/index.html#note-for-pnpm)ã«ã‚ˆã‚‹ã¨ã€

> In order to use with pnpm, youâ€™ll need to adjust your .npmrc to use any one the following approaches in order for your dependencies to be bundled correctly (ref: #6389):
>
> > node-linker=hoisted
>
> > public-hoist-pattern=\*
>
> > shamefully-hoist=true

ã®ã‚ˆã†ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã€‚
ã“ã‚Œã¯ã™ãªã‚ã¡ã€npm ã‚„ yarn(v1)ã‚’ä½¿ã£ãŸå ´åˆã¨åŒã˜ã‚ˆã†ãª node_modules ã®æ§‹æˆ(å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒ node_modules ã« hoisted ã•ã‚Œã‚‹)ã«ã—ã‚ã¨è¨€ã£ã¦ã„ã‚‹ãŒã€ã›ã£ã‹ã workspace ã¾ã§åˆ‡ã£ã¦ç–çµåˆåŒ–ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã®ã§ã€ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯é¿ã‘ã‚‹ã“ã¨ã«ã™ã‚‹ã€‚

electron-builder çš„ã«ã¯`electron`ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã«å¤±æ•—ã™ã‚‹ã®ã§ã€ã“ã‚Œã ã‘ public ãª hoist ã‚’è¨±å¯ã™ã‚‹ã“ã¨ã«ã™ã‚‹ã€‚

https://github.com/junkor-1011/electron-vite-react-sample-2023/blob/2023-06-28_2/.npmrc

(`public-hoist-pattern`ã«ã¤ã„ã¦ã¯[pnpm ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://pnpm.io/npmrc#public-hoist-pattern)ãªã©ã‚’å‚ç…§)

ä»Šå›ã¯`electron`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯å­ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹(main ãƒ—ãƒ­ã‚»ã‚¹)ã®æ–¹ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŒã€è¦ªãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‹ã‚‰ã‚‚è¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

ãã®ä»–ã®ä¾å­˜é–¢ä¿‚ã¯ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯`esbuild`ã§ãƒãƒ³ãƒ‰ãƒ«ã—ã€ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã§ã‚‚`vite`ãªã‚Š`nextjs`ãªã‚Šã§ã‚„ã¯ã‚Šãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãŠã‘ã°ã€è¦ªãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å¿…è¦ã¯å¿…ãšã—ã‚‚ãªã„ã€‚

ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å´ã¯é©å½“ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã®ã§çœç•¥ã™ã‚‹ã¨ã—ã¦ã€ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹å´ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã„ã¦ãƒãƒ³ãƒ‰ãƒ«ã—ã¦ã„ã‚‹ã€‚

https://github.com/junkor-1011/electron-vite-react-sample-2023/blob/2023-06-28_2/electron/scripts/build.ts

æœ€çµ‚çš„ã«`main/index.js`ã¨`main/preload.js`ã® 2 ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€[electron/index.ts](https://github.com/junkor-1011/electron-vite-react-sample-2023/blob/2023-06-28_2/electron/index.ts)ã¨[electron/preload.ts](https://github.com/junkor-1011/electron-vite-react-sample-2023/blob/2023-06-28_2/electron/preload.ts)ã‚’ãã‚Œãã‚ŒæŒ‡å®šã—ã¦ãƒ“ãƒ«ãƒ‰ã—ã¦ã„ã‚‹ã€‚ã¾ãŸã€`electron`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚ŒãŸã‚¢ãƒ—ãƒªå†…ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä½¿ãˆã‚‹ãŸã‚ã€ã“ã‚Œã ã‘ã¯ä¸€ç·’ã«ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ã¨å›°ã‚‹ãŸã‚`external`ã§æŒ‡å®šã—ã¦å¤–ã—ã¦ã„ã‚‹ã€‚

(å‚è€ƒ)

`electron`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯`devDependencies`ã«å…¥ã‚Œã‚‹ã¹ãã¨ã„ã†è©±:
https://github.com/electron-userland/electron-builder/issues/7191
ãŒã‚ã‚‹ãŒã€è‡ªåˆ†ãŒè©¦ã—ã¦ã„ã‚‹ç¯„å›²ã§ã¯ã€`electron-builder`ã‚’å®Ÿè¡Œã™ã‚‹éšå±¤(ä»Šå›ã¯è¦ªãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹)ã§ dependencies ã«å…¥ã£ã¦ã„ã‚Œã°å•é¡Œãªã•ãã†

#### Windows å‘ã‘ãƒ“ãƒ«ãƒ‰

Windows å‘ã‘ãƒ“ãƒ«ãƒ‰ã«ã¯[WineHQ](https://www.winehq.org/)ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã ã£ãŸã‚Šã™ã‚‹ã®ã§ã€è‡ªåˆ†ã®ç’°å¢ƒã‚’æ±šã—ãŸããªã‹ã£ãŸã‚Šã™ã‚‹å ´åˆã¯ãƒ“ãƒ«ãƒ‰ç”¨ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’ä½œã£ã¦ãã“ã§ãƒ“ãƒ«ãƒ‰ã•ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ãŒè‰¯ã„ã€‚

ä»Šå›ã¯è‡ªå‰ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ãŸ:
https://github.com/junkor-1011/electron-vite-react-sample-2023/blob/2023-06-28_2/Dockerfile

ãŒã€
https://www.electron.build/multi-platform-build.html#to-build-app-for-windows-on-linux
ã«ã‚ˆã‚‹ã¨ electon-builder å…¬å¼ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã‚‹:
https://hub.docker.com/layers/electronuserland/builder/18-wine/images/sha256-de2edd04a74711c0a730f6682ea248e56a5c47a0639c5376f4531e9e855eb3b7?context=explore
ã®ã§ã€ã“ã¡ã‚‰ã‚’å°‘ã—ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å½¢ã§ã‚‚è‰¯ã‹ã£ãŸã‹ã‚‚ã—ã‚Œãªã„ã€‚
(å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¨˜è¼‰ãŒåˆ†ã‹ã‚Šã¥ã‚‰ãã€Node v18 ç”¨ã®ã‚¿ã‚°ã¯`wine`ã§ãªã`18-wine`ã ã£ãŸã€‚`wine`ã®æ–¹ã¯ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚‚ Node ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚‚ç•°æ§˜ã«å¤ã‹ã£ãŸã‚Šã™ã‚‹ã€‚)

### é–‹ç™ºç”¨ã®å®Ÿè¡Œã®ã‚µãƒãƒ¼ãƒˆ

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ãªãã¦ã‚‚ã€ç°¡æ˜“çš„ã«å‹•ã‹ã›ãŸæ–¹ãŒé–‹ç™ºãŒæ—ã‚‹ã—ã€é–‹ç™ºç”¨ã«ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’ ON ã«ã™ã‚‹ãªã©ã¨ã„ã£ãŸä½™åœ°ã‚‚ã§ãã‚‹ãŸã‚ã€é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã‚’ç”¨æ„ã—ã¦ãŠãã€‚

é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã§ã¯`electron`ã‚³ãƒãƒ³ãƒ‰ã§ç›´æ¥ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã®`index.js`ã‚’å©ã‘ã°è‰¯ã„ã‚ˆã†ã«ã™ã‚‹ã€‚
ã‚‚ã¡ã‚ã‚“ã€å®Ÿéš›ã«ã¯ãã‚Œã«ç›¸å½“ã™ã‚‹ npm-scripts ã‚’ä½œã‚‹:

```json:package.json(è¦ªãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹)
{
  "scripts": {
    "dev:renderer": "pnpm --filter renderer dev",
    "dev:electron": "pnpm build:electron && electron . --inspect",
    "dev": "run-p dev:*",
  }
}
```

ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹å´(`dev:renderer`)ã«ã¤ã„ã¦ã¯ã€vite ã§ã‚‚ nextjs ã§ã‚‚é–‹ç™ºç”¨ã‚µãƒ¼ãƒãƒ¼ã®ç«‹ã¡ä¸Šã’ãŒå¯èƒ½(ã„ãšã‚Œã‚‚`dev`ã‚³ãƒãƒ³ãƒ‰ã§èµ·å‹•ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹)ãªã®ã§ã€
ã“ã‚Œã‚’å®Ÿè¡Œã•ã›ã¦ã„ã‚‹ã€‚
é–‹ç™ºæ™‚ã¯ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ãŒ localhost ã®é©å½“ãªãƒãƒ¼ãƒˆã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã€‚ã“ã‚Œã§ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ãªã©ãŒå¯èƒ½ã«ãªã‚‹ã€‚

ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹(`dev:electron`)ã‚‚æœ¬å½“ã¯ ts-node ã‚„ tsx ãªã©ã‚’ä½¿ã£ã¦ watch ãƒ¢ãƒ¼ãƒ‰ã§ã®å‹•ä½œãŒã§ãã‚‹ã¨è‰¯ã‹ã£ãŸã®ã ãŒã€`preload.js`ãªã©ã‚’æŒ‡å®šã™ã‚‹é–¢ä¿‚ã§é›£ã—ãã€ã“ã¡ã‚‰ã¯ä»•æ–¹ãªãé–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã§ã‚‚ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã“ã¨ã«ã—ã¦å¦¥å”ã—ã¦ã„ã‚‹ã€‚

ã¾ãŸã€é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã‹å¦ã‹ã¯ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹å´ã§`app.isPackaged`ã¨ã„ã† boolean å‹ã®å¤‰æ•°ã‚’è¦‹ã‚Œã°è­˜åˆ¥å¯èƒ½ã§ã‚ã‚Šã€â†“ ã®ã‚ˆã†ãªæ„Ÿã˜ã§å‡¦ç†ã‚’åˆ†ã‘ã¦ã„ã‚‹:

https://github.com/junkor-1011/electron-vite-react-sample-2023/blob/2023-06-28_2/electron/index.ts

```typescript:renderer/index.ts(æŠœç²‹)
declare const loadURL; // æœ¬ç•ªç”¨ã®rendererã®ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿è¨­å®š

// Prepare the renderer once the app is ready
app.on('ready', async () => {
  // session
  session.defaultSession.webRequest.onHeadersReceived((details, callback) => {
    // â†“æœ¬ç•ªã¨é–‹ç™ºæ™‚ã¨ã§ã€Content Security Policyã®è¨­å®šã‚’å¤‰ãˆã¦ã„ã‚‹
    const cspContents = app.isPackaged
      ? ["default-src 'self'"]
      : ["default-src 'self' 'unsafe-inline'"];
    callback({
      responseHeaders: {
        ...details.responseHeaders,
        'Content-Security-Policy': cspContents,
      },
    });
  });

  const mainWindow = new BrowserWindow({
    width: 1200,
    height: 900,
    webPreferences: {
      preload: join(__dirname, 'preload.js'),
    },
  });

  if (app.isPackaged) {
    // production
    await loadURL(mainWindow);
  } else {
    // development
    await mainWindow.loadURL(devServerUrl); // é–‹ç™ºæ™‚ã¯http://localhost:XXXX(viteã‚„nextjsã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®URL)ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
  }
});
```
