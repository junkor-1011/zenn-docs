---
title: "electronプロジェクトのボイラープレートを作ってみる(SPA by vite, MPA by Next.js)"
emoji: "🙌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["electron", "TypeScript", "pnpm", "vite", "nextjs"]
published: false
---

個人的にしっくりくる?[Electron](https://www.electronjs.org/ja/docs/latest)プロジェクトのボイラープレート的なものを模索してみた記録。

## TL;DR;

作ったもの(SPA バージョンと MPA バージョン)をそれぞれ以下に置く。

- SPA(Single Page Application) by vite + React

https://github.com/junkor-1011/electron-vite-react-sample-2023/tree/2023-06-28_2

- MPA(Multi Page Appliation) by nextjs

https://github.com/junkor-1011/electron-nextjs-sample-2023/tree/2023-06-28

それぞれ共通して、

```bash
# 開発に必要なnpmモジュールのインストール
pnpm install

# アプリのビルド・パッケージ化
pnpm dist     # Linux向け
pnpm dist:win # Windows向け

# 開発時におけるアプリの実行(レンダラープロセスに関してホットリロード、その他デバッグ機能の有効化など)
pnpm dev
```

のような感じで使えるようになっている。

いずれも Linux 上での開発を想定しており、Docker でビルド用コンテナを立ち上げることで Windows 向けのビルドも可能にしている。
(MacOS 向けビルドは個人的に必要性が無かったり、そもそも所有してないので動作確認できないとかで未対応。)

使用ツールのバージョンなどは各リポジトリの`package.json`などで規定されているので、この記事では特に触れない。

## 解説など

最低限、何をどういうつもりで作ったのかを補足していく。

2 つのリポジトリのリンクを貼ったが、どちらも本質的にはあまり変わらないため、[SPA 版](https://github.com/junkor-1011/electron-vite-react-sample-2023/tree/2023-06-28_2)の方をベースに書きつつ、差分があるところだけ少し補足する。

主なポイントとしては、

- ワークスペースによる機能分離
- esbuild と electron-builder を使ったビルド・パッケージ化
- 開発用の実行のサポート(※レンダラープロセスのみ)
- 型の export/import によるメインプロセスとレンダラープロセスの協調

などが挙げられ、それぞれざっくり説明する。

### プロジェクト構成

[pnpm workspace](https://pnpm.io/ja/workspaces)を使い、

- プロジェクト全体の管理とアプリのビルド(親ワークスペース)
- メインプロセス(子ワークスペース: `electron`ディレクトリ)
- レンダラープロセス(子ワークスペース: `renderer`ディレクトリ)

のように大きく 3 つに機能を分離し、それぞれをなるべく疎結合な感じにした。
(メインプロセスから react とかを import できたりするの気持ち悪いし、レンダラー側から electron を import できちゃうとかも嫌なので)

なお、構成や開発・ビルドに必要なコマンドを考える上で、nextjs のテンプレートの 1 つである[with-electron-typescript](https://github.com/vercel/next.js/tree/v13.4.7/examples/with-electron-typescript):

https://github.com/vercel/next.js/tree/v13.4.7/examples/with-electron-typescript

を参考にした。
(記述が古かったり、個人的にワークスペース化したかったなどの理由で全面的に作り変えたが)
