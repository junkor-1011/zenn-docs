---
title: "images.linuxcontainers.orgを利用して手軽に色々なWSL2ディストリビューションを作る"
emoji: "🤖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["wsl2", "wsl"]
published: true
---

WSL2ディストリビューションに関して、
Microsoft Storeからインストールできるものや、あるいは
`wsl --list --online`で表示されるリスト以外のディストリビューションをインストールしたくなったり、
あるいは同じ種類のディストリビューションを複数個インストールしたくなったりすることがある(目的別にUbuntu24.04を2つ並用する、とか)。

というときの選択肢を探ってみる。

## 方法

https://learn.microsoft.com/ja-jp/windows/wsl/use-custom-distro

に記載されているように、`wsl --import`コマンドでLinuxのコンテナの中身を含むtarファイルを取り込むことで任意のLinuxディストリビューションをWSL2に登録することができる。

上記のリンク先の解説ではDockerコンテナを使っているが、
`linuxcontainers.org`で公開されているイメージ:

https://images.linuxcontainers.org/

をそのまま`wsl --import`コマンドで取り込むことができ、即座に対応するWSL2ディストリビューションを作ることができる。

公開されているイメージは

- ubuntu
- debian
- fedora
- archlinux
- alpine
- almalinux
- rockylinux
- amazonlinux
- (その他数え切れないくらい多数)

といった感じで、かなり多くの選択肢がある。
(もちろん無いものもあるにはあるが)

所望のイメージのページに行き、`rootfs.tar.xz`をダウンロードし、

```powershell:powershell
wsl --import <登録するディストリビューション名> <仮想ディスクなどの保存場所のパス> <rootfs.tar.xzの保存パス>
```

のようにして、`wsl --import`の第3引数でダウンロードした`rootfs.tar.xz`を指定して取り込むと、所望のWSL2ディストリビューションをインポート出来る。

手元ではとりあえずubuntu-24.10(oracular), fedora41, amazonlinux2023, archlinuxあたりをインポートしてみたが、どれも問題なく起動した。

## (ToDo)ディストリビューションのセットアップ・プロビジョニング

全部のイメージがそうかまでは確認できていないが、見た範囲ではどのディストリビューションでもユーザーがrootしか存在しないため、
実用的にはユーザーの作成などを行う必要がある。
また、パッケージ・ライブラリの追加や設定ファイルの記入なども一般には必要になる。

ここで、WSL2ではcloud-init:

https://cloudinit.readthedocs.io/en/latest/reference/datasources/wsl.html

https://documentation.ubuntu.com/wsl/en/latest/tutorials/cloud-init/

が使えるため、cloud-initを使うことでWSL2の初期設定を自動化し、再現性の高いものにできる可能性がある。

が、手元で動作確認がうまくできていないので、暇だったら今後調査する(かもしれない)。

とりあえず紹介だけしておく。

## 参考

### (検証環境)

- Windows11(x86_64)
  - バージョン23H2 (OSビルド22631.4460)
- wslバージョン:

```powershell
wsl --version
WSL バージョン: 2.3.26.0
カーネル バージョン: 5.15.167.4-1
WSLg バージョン: 1.0.65
MSRDC バージョン: 1.2.5620
Direct3D バージョン: 1.611.1-81528511
DXCore バージョン: 10.0.26100.1-240331-1435.ge-release
Windows バージョン: 10.0.22631.4460
```

### 参考1 昔書いた記事

https://zenn.dev/junkor/articles/e2b8d7815bd44a

Dockerfileを使ってイメージ内容を自由にカスタマイズできる、という記事。
極めて高い自由度がメリットだが、一方で、Dockerで使われるベースイメージは一般にごく最低限のパッケージしか入っていないため、WSL2のような開発や普段使い?するためには色々と不足や差分があり、カスタマイズ(Dockerfileの記入)が大変なところがあった。
(あと、`docker export`などを行うのが面倒)

images.linuxcontainers.org で公開されているイメージはそのまま`wsl --import`することができ、
dockerイメージよりは最低限使いそうなパッケージが入っていることが多そう?なので、より手軽に色々なディストリビューションを導入できると思われる。

### 参考2 distod

https://github.com/nullpo-head/wsl-distrod

WSL2でsystemdを使えるようにする他、
WSL2に[linuxcontainers.org](https://linuxcontainers.org/)で入手できるあらゆるイメージをWSL2にインストールできるツールらしい。
(まだwsl2で満足にsystemdが使えなかったときに、systemdを使う手段として使われていた気がする。)

前者の機能のためにこのツールを存在を知ったが、今回の記事の内容は後者の方の機能に着想を得ている。
