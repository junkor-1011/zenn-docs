---
title: "Hyper-Vã§Linuxç’°å¢ƒ(ArchLinux)ã‚’ç«‹ã¡ä¸Šã’ã¦ã¿ã‚‹"
emoji: "ğŸ˜¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["archlinux", "hyperv", "windowsterminal", "wsl"]
published: false
---

ç‰¹ã«ArchLinuxã«è©³ã—ã„ã¨ã‹ã§ã¯ç„¡ã„ãŒã€ãªã‚“ã¨ãªãã‚„ã£ã¦ã¿ãŸããªã£ãŸã®ã§ãƒ¡ãƒ¢ã€‚

## æ–¹é‡ãƒ»ç›®æ¨™ãªã©

Windowsã‹ã‚‰Hyper-Vä¸Šã®archlinuxã¸ã®æ¥ç¶šã«ã¯sshã‚’ä½¿ã†ã€‚
Windows Terminalã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ç™»éŒ²ã—ã¦ãŠãã“ã¨ã§ã€WSLã‚’èµ·å‹•ã™ã‚‹ã®ã¨å¤§ããã¯å¤‰ã‚ã‚‰ãªã„ä½¿ç”¨æ„Ÿã§æ¥½ã«èµ·å‹•ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

ã‚†ã‚‹ãµã‚å‹¢ãªã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«ã¯`archinstall`:

https://wiki.archlinux.org/title/archinstall

https://github.com/archlinux/archinstall

ã‚’ä½¿ã£ã¦ã‚ã¾ã‚Šé ‘å¼µã‚‰ãšã«ã‚„ã‚‹ã€‚
https://github.com/archlinux/archinstall
([Manjaro](https://manjaro.org/)ã«Desktopç„¡ã—ã®ã‚µãƒ¼ãƒãƒ¼ç‰ˆãŒã‚ã‚Œã°ãã‚Œã§è‰¯ã‹ã£ãŸã‚ˆã†ãªã€ã¨ã„ã†æ°—ãŒã™ã‚‹)

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆã‚„sshå‘¨ã‚Šã®è¨­å®šãªã©ã¯ã€éµã®ç™»éŒ²ã‚’è‡ªå‹•åŒ–ã—ã‚„ã™ã‹ã£ãŸã‚Šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãªã©è«¸ã€…ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒã§ãã‚‹ã®ã§`cloud-init`ã‚’ä½¿ã£ã¦è¡Œã†ã€‚

https://cloud-init.io/

(ä»–ã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚‚çŸ¥è¦‹ã‚’ä½¿ã„å›ã—ã‚„ã™ã„ã®ã‚‚å¤§ãã„)

## æ‰‹é †

![](https://storage.googleapis.com/zenn-user-upload/79817e604016-20240517.png)

![](https://storage.googleapis.com/zenn-user-upload/4a10cd833a77-20240517.png)

![](https://storage.googleapis.com/zenn-user-upload/98b35138e09b-20240517.png)

![](https://storage.googleapis.com/zenn-user-upload/0476bd0341d5-20240517.png)

![](https://storage.googleapis.com/zenn-user-upload/8cff635f7cd3-20240517.png)

https://ftp.jaist.ac.jp/pub/Linux/ArchLinux/iso/2024.05.01/

![](https://storage.googleapis.com/zenn-user-upload/b59146ec2ae8-20240517.png)

â†‘Linuxã‚’èµ·å‹•ã™ã‚‹éš›ã¯å¿…ãšã€Œã‚»ã‚­ãƒ¥ã‚¢ãƒ–ãƒ¼ãƒˆã€ã‚’OFFã«ã™ã‚‹
(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ONã«ãªã£ã¦ã„ã‚‹ãŒã€OFFã«ã—ãªã„ã¨èµ·å‹•ã§ããªã„)

![](https://storage.googleapis.com/zenn-user-upload/b115c8ea559b-20240517.png)

![](https://storage.googleapis.com/zenn-user-upload/403fe732309c-20240517.png)

![](https://storage.googleapis.com/zenn-user-upload/8d6c845a1c71-20240517.png)

![](https://storage.googleapis.com/zenn-user-upload/4016c9a388ef-20240517.png)

![](https://storage.googleapis.com/zenn-user-upload/ac4558d9c11b-20240517.png)

ã“ã“ã§ã¯"Use a best-effort default partition layout"ã‚’é¸æŠã™ã‚‹

![](https://storage.googleapis.com/zenn-user-upload/68bfd9c8441f-20240517.png)

![](https://storage.googleapis.com/zenn-user-upload/805e36699d7e-20240517.png)

![](https://storage.googleapis.com/zenn-user-upload/1452a3b2fece-20240517.png)

ã“ã“ã§ã¯"no"ã‚’é¸æŠã—ã¦åŒã˜ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã¨ã—ãŸ

![](https://storage.googleapis.com/zenn-user-upload/8d6ee61e0194-20240517.png)

ãƒ›ã‚¹ãƒˆ(Windows)å´ã‹ã‚‰sshæ¥ç¶šã—ãŸã„ã®ã§Typeã¯"Server"ã®"sshd"ã‚’é¸æŠ

![](https://storage.googleapis.com/zenn-user-upload/4756efe413ed-20240517.png)

"Additional packages"ã«ã¤ã„ã¦ã€

- `cloud-init`
    - (å¾Œã§ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã™ã‚‹ç”¨)
- `cloud-guest-utils`
    - growpart(å¾Œã‹ã‚‰ãƒ‡ã‚£ã‚¹ã‚¯ã‚’æ‹¡å¼µã—ãŸéš›ã«ã€è‡ªå‹•ã§ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚µã‚¤ã‚ºã‚’èª¿æ•´ã—ã¦ãã‚Œã‚‹)ãªã©ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãŠã
- `vim`, `less`ã¯ä¸€å¿œå…¥ã‚Œã¦ãŠã
- `xorg-xeyes`: x11ã®å‹•ä½œç¢ºèªã‚’ã—ãŸã„ã®ã§(å¾Œã§cloud-initã§å…¥ã‚Œã¦ã‚‚è‰¯ã„ãŒ)

ä»Šå›`cloud-init`ã‚’ä½¿ã†äºˆå®šãªã®ã§ã“ã“ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‚‚ã®ã¯æœ€å°é™ã«ã—ã¦ã„ã‚‹ãŒã€
ã“ã“ã§å¥½ãã«è‰²ã€…ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‚è‰¯ã„

![](https://storage.googleapis.com/zenn-user-upload/42352fc71265-20240517.png)

`user_configuration.json`ãŠã‚ˆã³ã€`user_credentials.json`ã¯é©å½“ã«ä¿å­˜ã—ã¦ãŠã

![](https://storage.googleapis.com/zenn-user-upload/7a0e25f19fc7-20240517.png)

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ãŸã‚‰ã€`chroot`ã—ã¦æ–°ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‚ã®ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦å¿…è¦ãªåˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒã§ãã‚‹ã€‚

ä»Šå›ã¯`cloud-init`ã®serviceæœ‰åŠ¹åŒ–ã‚’ã—ãŸã„ã®ã§yesã€‚

![](https://storage.googleapis.com/zenn-user-upload/02013d407dee-20240517.png)

```sh
systemctl enable cloud-init
systemctl enable cloud-init-local
systemctl enable cloud-config
systemctl enable cloud-final
```

ã‚’é †æ¬¡å®Ÿè¡Œã™ã‚‹ã€‚
(ä»–ã«ã‚„ã‚ŠãŸã„ã“ã¨ãŒã‚ã‚Œã°é©å®œã‚„ã£ã¦ãŠã)

exitã§æŠœã‘ã‚‹ã¨"Installation completed without any errors. You may now reboot."ã¨å‡ºã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/1a785efa1ab7-20240517.png)

ä»Šå›ã¯å…ˆã»ã©ä¿å­˜ã—ãŸ`user_configuration.json`ã¨`user_credentials.json`ã‚’å›åã—ãŸã®ã§ã™ãã«ã¯rebootã—ãªã„ã€‚

ã¾ãšã¯ä»®æƒ³ãƒã‚·ãƒ³ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’`ip a`ãªã©ã§èª¿ã¹ã‚‹ã€‚

æ¬¡ã«ã€ãŠãã‚‰ããƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§pythonãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã¯ãšãªã®ã§ã€

```sh
python -m http.server
```

ã‚’ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œã—ã€8000ãƒãƒ¼ãƒˆã§å…¬é–‹ã™ã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/19bb51723612-20240517.png)

![](https://storage.googleapis.com/zenn-user-upload/38e31da4bac8-20240517.png)

Windowså´ã§"http://<å…ˆã»ã©èª¿ã¹ãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹>:8000"ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€
`user_configuration.json`ã¨`user_configuration.json`ãŒè¦‹ãˆã‚‹ã®ã§ã“ã“ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãŠãã€‚
(æ¬¡å›ä»¥é™ã€ä»Šå›ã¨åŒã˜è¨­å®šã‚’ä½¿ã£ã¦ç´ æ—©ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã€‚)

ä¸Šè¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ä¿å­˜ã—çµ‚ãˆãŸã‚‰ä¸€æ—¦çµ‚äº†ã™ã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/5d03136dd1d8-20240517.png)

ä»®æƒ³ãƒã‚·ãƒ³ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢(isoãƒ•ã‚¡ã‚¤ãƒ«)ã‚’é™¤å»ã—ã€
ä»£ã‚ã‚Šã«å…ˆã»ã©`genisoimage`ã‚’ä½¿ã£ã¦ä½œæˆã—ãŸisoãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã€‚
